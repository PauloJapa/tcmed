window.App?window.App.ACTIONS={}:window.App={SETTINGS:{},ACTIONS:{}};var action=window.App.ACTIONS;action=function($,options){var errors={serverNotFound:function(url,e){console.error("Servidor '"+url+"' não pode ser localizado!\n Verifique o endereco do servidor! "+e)},accessDanied:function(){console.error("Acesso não permitido")}};return{requestServer:function(arg){return arg.url=arg.url+"?ajax=ok&","POST"!==arg.type&&(arg.type="GET",arg.url=arg.url+"?ajax=ok&"+Math.ceil(1e5*Math.random())),$.ajax(arg).fail(function(e,status){errors.serverNotFound(arg.url,status)})},processa:function(obj){if(options.lastRequest=obj,""!==obj.url&&"#"!==obj.url){obj.ret=obj.ret?obj.ret:settings.defReturn,action.loader(!0),module.Pagination.savePage();action.requestServer({url:settings.path+obj.url,data:transformFormToObject($("#"+obj.frm)),type:obj.frm?"POST":"GET"}).done(function(data){$(obj.ret).html(data)}).complete(function(){action.loader(!1),module.Pagination.addPage()})}},notification:function(options){if("Notification"in window)if("granted"===Notification.permission){new Notification(options.title,options)}else"denied"!==Notification.permission&&Notification.requestPermission(function(permission){if("permission"in Notification||(Notification.permission=permission),"granted"===permission){new Notification(options.title,options)}});else console.log("Este browser não suporta notificações de desktop")},loader:function(status){void 0===$(".loader").html()&&($("body").append('<i class="loader fa fa-3x fa-spinner fa-spin"></i>'),$(".loader").css({position:"absolute",left:"50%",top:"50%"})),status?$(".loader").show():$(".loader").hide()},nextFocus:function(obj){for(var inputs=$(obj).closest("form").find(":input:visible"),ind=inputs.index(obj),i=1,flag=!0;flag;)if(ele=inputs.eq(ind+i),tp=ele.prop("type"),ele.prop("disabled"))i++;else switch(tp){case"button":i++;break;default:ele.focus(),flag=!1}}}}(jQuery,App.SETTINGS),window.App?window.App.MODULES={}:window.App={SETTINGS:{},MODULES:{}};var module=window.App.MODULES;module.Pagination=function(window,document,$,settings){var defaults={back:".godown",next:".goup",menu:"#side-menu",cont:"#inter",iniArray:1,cursor:0,endArray:0,lenghtArray:9,pages:{menu:{},data:{}}},getPage=function(){return fixDataForm(),$(settings.pagin.cont).html()},savePageCache=function(){settings.pagin.pages.data[settings.pagin.cursor]=getPage()},fixDataForm=function(){var cont=$(settings.pagin.cont);cont.find("input").each(function(){$(this).prop("checked")?$(this).attr("checked","checked"):$(this).removeAttr("checked"),$(this).attr("value",$(this).val())}),cont.find("select").each(function(){$(this).find("option").not($(this).find("option:selected")).removeAttr("selected"),$(this).find("option:selected").attr("selected","selected")}),cont.find("textarea").each(function(){$(this).text($(this).val())})},managerClickPagin=function(){var next=$(settings.pagin.next),back=$(settings.pagin.back),cont=$(settings.pagin.cont);back.attr("disabled",!0),next.attr("disabled",!0),$(document).on("click",settings.pagin.back,function(){next.attr("disabled",!1),savePageCache(),settings.pagin.cursor--,cont.html(settings.pagin.pages.data[settings.pagin.cursor]),$(settings.pagin.pages.menu[settings.pagin.cursor]).click(),settings.pagin.cursor===settings.pagin.iniArray&&back.attr("disabled",!0)}),$(document).on("click",settings.pagin.next,function(){back.attr("disabled",!1),savePageCache(),settings.pagin.cursor++,cont.html(settings.pagin.pages.data[settings.pagin.cursor]),$(settings.pagin.pages.menu[settings.pagin.cursor]).click(),settings.pagin.cursor===settings.pagin.endArray&&next.attr("disabled",!0)})};return{init:function(options){settings.pagin={},$.extend(settings.pagin,options,defaults),this.addPage(),managerClickPagin()},savePage:function(){settings.pagin&&savePageCache()},addPage:function(){settings.pagin&&(settings.pagin.cursor>=settings.pagin.iniArray&&$(settings.pagin.back).attr("disabled",!1),settings.pagin.cursor++,settings.pagin.endArray=settings.pagin.cursor,savePageCache(),settings.pagin.pages.menu[settings.pagin.cursor]=$(settings.pagin.menu).find("a.active"),settings.pagin.endArray-settings.pagin.iniArray>settings.pagin.lenghtArray&&settings.pagin.iniArray++,$(settings.pagin.next).attr("disabled",!0))}}}(window,document,jQuery,App.SETTINGS),module.Messenger=function(window,document,$,options){var settings={element:"messenger",userId:"username",status:"online",server:"/app/messenger",interval:5e3,notify:!0,topDifference:0,userTo:"nobody",open:!0,contacts:{}},events=function(){$(document).on("click","#chat-send",function(){sendMessage()}),$(document).on("keyup","#msg-chat",function(e){13===e.keyCode&&$("#send-enter").is(":checked")&&($("#chat-send").click(),e.preventDefault())}),$(document).on("click",".view-all",function(){$(".show-users").find(".active").removeClass("active"),$(this).addClass("active"),$("#chat-contacts").find("button").show()}),$(document).on("click",".view-online",function(){$(".show-users").find(".active").removeClass("active"),$(this).addClass("active"),$("#chat-contacts").find("button").hide(),$("#chat-contacts").find(".btn-success").show(),$("#chat-contacts").find(".btn-danger").show()}),$(document).on("click",".view-groups",function(){$(".show-users").find(".active").removeClass("active"),$(this).addClass("active"),$("#chat-contacts").find("button").hide(),$("#chat-contacts").find(".btn-primary").show()}),$(document).on("keyup","#text-search",function(){$(".view-all").click(),$("#chat-contacts").find("button").hide(),$.each(settings.contacts,function(index,contact){var cont=contact.name.toUpperCase(),str=$("#text-search").val().toUpperCase();cont.indexOf(str)>-1&&$(".btn-"+index).show()})}),$(document).on("click",".setOnline",function(){$("#drop-chat").removeClass("offline").removeClass("busy").addClass("online"),sendStatus("online"),settings.notify=!0}),$(document).on("click",".setBusy",function(){$("#drop-chat").removeClass("offline").removeClass("online").addClass("busy"),sendStatus("busy"),settings.notify=!1}),$(document).on("click",".setOffline",function(){$("#drop-chat").removeClass("busy").removeClass("online").addClass("offline"),sendStatus("offline"),settings.notify=!1}),$(document).on("click",".btn-get",function(){$(".chat-list").animate({opacity:0},"slow").hide(),$(".chat-window").css("opacity","0").show().animate({opacity:1},"fast"),buildConversation($(this).attr("id"))}),$(document).on("click","#chat-back",function(){$(".chat-window").animate({opacity:0},"fast").hide(),$(".chat-list").show().animate({opacity:1},"slow")}),$(document).on("click","#drop-chat",function(){settings.open||($(".messenger").width($("#drop-chat").width()+$("#messenger-box").width()+25),$("#drop-chat").css("margin-right","0px")),$("#messenger-box").toggle("show",function(){settings.open||($(".messenger").width($("#drop-chat").width()),$("#drop-chat").css("margin-right","3px"))}),settings.open=!settings.open})},formatData=function(){var d=new Date;return d.getHours()+":"+d.getMinutes()},sendMessage=function(){var msg=$("#msg-chat").val(),message={dtime:formatData(),msg:$.trim(msg),userby:settings.userId,userto:settings.userTo,typeusr:"user",type:"sendMsg"},data=action.requestServer(message);data.success(function(){settings.contacts[settings.userTo].logMsg.push(message),printMessage(message)}),$("#msg-chat").val("")};$.getPositionArray=function(array,key){for(var i=0;i<array.length;i++)if(array[i]===key)return i};var printMessage=function(message){if("sendMsg"===message.type)$(".chat-view").append("<div class='msg-me'><em>("+message.dtime+") Eu digo:</em><br>"+message.msg+"</div>");else if("group"===message.typeusr){var userby=settings.contacts[message.userby]?settings.contacts[message.userby].name:message.userby;$(".chat-view").append("<div class='msg-"+$.getPositionArray(settings.contacts[message.userto].usersgroup,message.userby)+"'><em>("+message.dtime+") "+userby+" Diz:</em><br>"+message.msg+"</div>")}else $(".chat-view").append("<div class='msg-0'><em>("+message.dtime+") "+settings.contacts[message.userby].name+" Diz:</em><br>"+message.msg+"</div>")},sendStatus=function(status){settings.status=status,action._requestServer({type:"sendStatus",status:status,userId:settings.userId})},changeStatus=function(data,canNotify){canNotify=0==canNotify?canNotify:!0;var state={online:"success",busy:"danger",offline:"warning",group:"primary"};$.each(data,function(name,status){if(settings.contacts[name].status=status,$.each(state,function(k,classe){$(".btn-"+name).removeClass("btn-"+classe),$(".panel-"+name).removeClass("panel-"+classe)}),$(".btn-"+name).addClass("btn-"+state[status]),$(".panel-"+name).addClass("panel-"+state[status]),canNotify&&settings.notify){var aux={title:settings.contacts[name].name,dir:"ltr"};switch(status){case"offline":aux.body="Saiu do chat",action.notification(aux);break;default:aux.body="Entrou no chat",action.notification(aux)}}})},receiveContacts=function(){var data={paulo_tcmed:{name:"Paulo",type:"user",status:"offline"},alan_tcmed:{name:"Alan",type:"user",status:"online"},danilo_tcmed:{name:"Danilo",type:"user",status:"online"},tcmed:{name:"Tecnomed",type:"group",status:"group",usersgroup:["paulo_tcmed","alan_tcmed","danilo_tcmed"]}};$.each(data,function(name,params){settings.contacts[name]=params,setTimeout(function(){var icon="";icon="group"===settings.contacts[name].type?"<i class='fa fa-group'></i>&nbsp;&nbsp;&nbsp;":"<i class='fa fa-user'></i>&nbsp;&nbsp;&nbsp;",settings.contacts[name].logMsg||(settings.contacts[name].logMsg=new Array),$("#chat-contacts").append("<button id="+name+" class='btn btn-get btn-block btn-"+name+"'>"+icon+settings.contacts[name].name+"</button>");var aux={};aux[name]=params.status,changeStatus(aux,!1)},100)})};$.fn.outerHTML=function(){return $("<a>").append(this.eq(0).clone()).html()},$.fn.top=function(top){$(this).css("top",top)};var buildHtml=function(){var data=action.requestServer({url:settings.server+"/index",data:{type:"getHtml"}});data.success(function(data){$(".messenger").append(data);var topo=$(".navbar").height(),doc=$(document).height()-topo-5;$(".messenger").height(doc).top(topo),$("#messenger-box").height(doc).top(topo),$(".chat-window").hide(),$(".messenger").append('<div id="drop-chat"><i class="fa fa-weixin fa-2x"></i></div>'),$("#drop-chat").addClass("online"),settings.open||($(".messenger").width($("#drop.chat").width()+35),$("#messenger-box").hide(),$("#drop-chat").width($("#drop-chat").width())),settings.backupChat=$(".chat-window").html()})},buildConversation=function(user){$(".chat-window").html(settings.backupChat),$("#nameusr").text(settings.contacts[user].name),$(".panel-usr").removeClass("panel-usr").addClass("panel-"+user),$(".btn-usr").removeClass(".btn-usr").addClass("btn-"+user);var icon="";icon="<i class='fa fa-group'></i>&nbsp;&nbsp;&nbsp;","group"===settings.contacts[user].type&&($.each(settings.contacts[user].usersgroup,function(key,name){name=settings.contacts[name]?settings.contacts[name].name:name,$("#chat-group-users").text($("#chat-group-users").text()+name+", ")}),$("#chat-group-users").text($("#chat-group-users").text()+" eu."),icon="<i class='fa fa-user'></i>&nbsp;&nbsp;&nbsp;");var sizeTotal=$("#page-wrapper").height(),heading=$(".panel-heading").height()+20,row0=$(".row-0").height(),row2=$(".row-2").height(),row3=$(".row-3").height(),row4=$(".row-4").height(),espacos=64;$(".chat-view").height(sizeTotal-(heading+row0+row2+row3+row4+espacos)),settings.userTo=user,setTimeout(function(){var aux={};aux[user]=settings.contacts[user].status,changeStatus(aux,!1)},1),$.each(settings.contacts[user].logMsg,function(key,values){printMessage(values)})},messenger=function(){$("body").append("<div class='"+settings.element+"'></div>"),settings.element=$(settings.element)};return{init:function(options){$.extend(settings,options,settings),messenger(),buildHtml(),receiveContacts(),events()}}}(window,document,jQuery,App.SETTINGS),module.Cookie=function(window,document,$,settings){var defaults={expires:1};return{save:function(obj){void 0==settings.cookies&&(settings.cookies={}),settings.cookies[obj.key]=obj.value},set:function(cookie){cookie.expires=cookie.expires?cookie.expires:defaults.expires,cookie.expires=d.toGMTString(cookie.expires),document.cookie=cookie.name+"="+cookie.value+"; expires="+cookie.expires},get:function(cname){for(var name=cname+"=",ca=document.cookie.split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1);if(0==c.indexOf(name))return c.substring(name.length,c.length)}return""}}}(window,document,jQuery,window.App.SETTINGS),window.App?window.App.events={}:window.App={settings:{},events:{}};var event=window.App.events;event=function($,options){return{init:function(){$(document).on("click","#refreshPage",function(){options.lastRequest&&action.processa(options.lastRequest)})}}}(jQuery,App.SETTINGS);